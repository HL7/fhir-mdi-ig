<?xml version="1.0" encoding="UTF-8"?>
<CapabilityStatement xmlns="http://hl7.org/fhir">
    <id value="CapabilityStatement-mdi-cms-server"/>
    
    <text>
        <status value="generated"/>
        <div xmlns="http://www.w3.org/1999/xhtml">
            <h2 id="test1" class="no_toc">MDI CMS Server Capabilities Summary</h2>
            <ul>
                <li>The MDI CMS Server should be a producer of Composition-mdi-and-edrs, and may
                    also be a consumer of Composition-mdi-and-edrs.</li>
                <li>The MDI CMS Server may specify RESTful operations for resources. At a minimum,
                    it should support read and search for the set of resources defined here.</li>
                <li>The MDI CMS Server may support messaging with forensic toxicology, for
                    example.</li>
            </ul>
            <h2 id="test1" class="no_toc">API Specifications Search Operations</h2>
            <p>The MDI CMS Server may use extended operations with MDI-specific search parameters
                and a subset of the many [RESTful API](https://hl7.org/FHIR/http.html).</p>
            <p>All API implementations of this MDI FHIR IG must conform to common design
                rules:</p>
            <ul>
                <li>MIME-type for FHIR resources is application/fhir+xml or application/fhir+json.
                    This must be specified for Content-Type in the HTTP header. </li>
                <li>application/x-www-form-urlencoded can be used for POST search requests if HTTP
                    Form is used. </li>
            </ul>
            <p>An MDI-based Search API enables an MDI CMS to search an EDRS for decedent cases, and
                vice versa. This is an idempotent operation. At a minimum, both Both POST and GET
                can be used should be allowed with the following endpoint URL pattern:</p>
            <ul>
                <li>POST [base]/Composition/$document </li>
                <li>GET [base]/Composition/$document?name=value… </li>
            </ul>
            <p id="summary">
                <strong>Summary of Minimum MDI Search Parameter Definitions</strong>
            </p>
            <table class="grid">
                <thead>
                    <tr>
                        <th>Search Parameter Name</th>
                        <th>Cardinality</th>
                        <th>Type</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><b><i>In Parameters</i></b></td>
                        <td>  </td>
                        <td>  </td>
                        <td>  </td>
                    </tr>
                    <tr>
                        <td>id</td>
                        <td>0..1</td>
                        <td>uri</td>
                        <td>Composition.id of Composition - MDI and EDRS</td>
                    </tr>
                    <tr>
                        <td>tracking-number</td>
                        <td>0..*</td>
                        <td>token</td>
                        <td>Composition.extension:extension-tracking-number of Composition - MDI and
                            EDRS</td>
                    </tr>
                    <tr>
                        <td>patient</td>
                        <td>0..*</td>
                        <td/>
                        <td>One or more US Core Patient decedent-related search parameters</td>
                    </tr>
                    <tr>
                        <td>patient.birthdate</td>
                        <td>0..1</td>
                        <td>date</td>
                        <td>Decedent’s date of birth</td>
                    </tr>
                    <tr>
                        <td>patient.family</td>
                        <td>0..1</td>
                        <td>string</td>
                        <td>Decedent’s last name</td>
                    </tr>
                    <tr>
                        <td>patient.given</td>
                        <td>0..1</td>
                        <td>string</td>
                        <td>Decedent’s first name</td>
                    </tr>
                    <tr>
                        <td>patient.gender</td>
                        <td>0..1</td>
                        <td>token</td>
                        <td>Decedent’s gender</td>
                    </tr>
                    <tr>
                        <td>death-location</td>
                        <td>0..1</td>
                        <td>string</td>
                        <td>Location.address in Location-death </td>
                    </tr>
                    <tr>
                        <td>death-date</td>
                        <td>0..1</td>
                        <td>date</td>
                        <td>Value[x] (actual or presumed date of death) in Observation - Death Date
                            (either dateTime or Period)</td>
                    </tr>
                    <tr>
                        <td>death-date-pronounced</td>
                        <td>0..1</td>
                        <td>date</td>
                        <td>Observation.component:datetimePronouncedDead in Observation - Death Date
                            (either time or dateTime)</td>
                    </tr>
                    <tr>
                        <td><b><i>Out Parameters</i></b></td>
                        <td>  </td>
                        <td>  </td>
                        <td>  </td>
                    </tr>
                    <tr>
                        <td>return</td>
                        <td>0..1</td>
                        <td>Bundle</td>
                        <td>Bundle - Searchset or Bundle - Document MDI and EDRS. If [id] is supplied, then this should be Bundle - Document MDI and EDRS</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </text>
    
    <url value="http://hl7.org/fhir/us/mdi/CapabilityStatement/CapabilityStatement-mdi-cms-server"/>
    <name value="CapabilityStatementMdiCmsServer"/>
    <title value="CapabilityStatement - MDI CMS Server"/>
    <status value="active"/>
    <experimental value="false"/>
    <date value="2022-07-03"/>
    <description
        value="This resource describes expected capabilities of an MDI CMS Server which is responsible for providing responses to the queries submitted by a Client. It lists FHIR profiles and search parameters that, at a minimum, should be supported by MDI CMS Servers. MDI CMS Clients have the option of choosing from this list to access necessary data."/>
    <kind value="requirements"/>
    <fhirVersion value="4.0.1"/>
    <format value="application/fhir+xml"/>
    <format value="xml"/>
    <format value="application/fhir+json"/>
    <format value="json"/>
    <rest>
        <mode value="server"/>
        <!-- Composition-mdi-and-edrs -->
        <resource>
            <type value="Composition"/>
            <supportedProfile
                value="http://hl7.org/fhir/us/mdi/StructureDefinition/Composition-mdi-and-edrs"/>
            <interaction>
                <code value="search-type"/>
            </interaction>
            <interaction>
                <code value="read"/>
            </interaction>
            <searchParam>
                <name value="subject"/>
                <type value="reference"/>
                <documentation value="Who and/or what the composition is about"/>
            </searchParam>
            <searchParam>
                <name value="patient"/>
                <type value="reference"/>
                <documentation value="Who and/or what the composition is about"/>
            </searchParam>
            <operation>
                <name value="operation-composition-document"/>
                <definition value="https://hl7.org/fhir/operation-composition-document"/>
                <documentation
                    value="A server should be capable of generating a bundled document from a composition resource with all the referenced resources and either returns a full document bundle, or returns an error."
                />
            </operation>
        </resource>
        <!-- US Core Patient -->
        <resource>
            <type value="Patient"/>
            <supportedProfile
                value="http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient"/>
            <interaction>
                <code value="read"/>
            </interaction>
            <interaction>
                <code value="search-type"/>
            </interaction>
            <searchParam>
                <name value="_id"/>
                <type value="token"/>
                <documentation value="The ID of the resource"/>
            </searchParam>
            <searchParam>
                <name value="birthdate"/>
                <definition
                    value="http://hl7.org/fhir/us/core/SearchParameter/us-core-patient-birthdate"/>
                <type value="date"/>
                <documentation value="The patient's date of birth"/>
            </searchParam>
            <searchParam>
                <name value="family"/>
                <type value="string"/>
                <documentation value="A portion of the family name of the patient"/>
            </searchParam>
            <searchParam>
                <name value="given"/>
                <definition
                    value="http://hl7.org/fhir/us/core/SearchParameter/us-core-patient-given"/>
                <type value="string"/>
                <documentation value="A portion of the given name of the patient"/>
            </searchParam>
            <searchParam>
                <name value="gender"/>
                <definition
                    value="http://hl7.org/fhir/us/core/SearchParameter/us-core-patient-gender"/>
                <type value="token"/>
                <documentation value="Gender of the patient"/>
            </searchParam>
            <searchParam>
                <name value="name"/>
                <definition value="http://hl7.org/fhir/us/core/SearchParameter/us-core-patient-name"/>
                <type value="string"/>
                <documentation
                    value="A server defined search that may match any of the string fields in the HumanName, including family, give, prefix, suffix, suffix, and/or text"
                />
            </searchParam>
        </resource>
        <!-- Location-death -->
        <resource>
            <type value="Location"/>
            <supportedProfile value="http://hl7.org/fhir/us/mdi/StructureDefinition/Location-death"/>
            <interaction>
                <code value="read"/>
            </interaction>
            <interaction>
                <code value="search-type"/>
            </interaction>
            <searchParam>
                <name value="address"/>
                <type value="string"/>
            </searchParam>
        </resource>
        <!-- Observation-death-date -->
        <resource>
            <type value="Observation"/>
            <supportedProfile
                value="http://hl7.org/fhir/us/mdi/StructureDefinition/Observation-death-date"/>
            <interaction>
                <code value="read"/>
            </interaction>
            <interaction>
                <code value="search-type"/>
            </interaction>
            <searchParam>
                <name value="date"/>
                <type value="date"/>
            </searchParam>
        </resource>

    </rest>

    <rest>
        <mode value="client"/>
        <!--Returned Searchset Bundle -->
        <resource>
            <type value="Bundle"/>
            <supportedProfile
                value="http://hl7.org/fhir/us/mdi/StructureDefinition/Bundle-document-mdi-and-edrs"/>
            <interaction>
                <code value="read"/>
            </interaction>
        </resource>
    </rest>

    <messaging>
        <supportedMessage>
            <mode value="receiver"/>
            <definition
                value="http://hl7.org/fhir/us/mdi/MessageDefinition/MessageDefinition-toxicology-system"
            />
        </supportedMessage>
    </messaging>
    <document>
        <mode value="producer"/>
        <profile value="https://fhir.org/fhir/us/mdi/StructureDefinition/Composition-mdi-and-edrs"/>
    </document>
    <document>
        <mode value="consumer"/>
        <profile value="https://fhir.org/fhir/us/mdi/StructureDefinition/Composition-mdi-and-edrs"/>
    </document>
</CapabilityStatement>
